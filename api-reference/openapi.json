{
    "openapi": "3.1.0",
    "info": {
      "title": "Chatlevel API",
      "description": "Chatlevel is a WhatsApp web API to manage any WhatsApp account programmatically.",
      "version": "v1.0.0"
    },
    "servers": [
      {
        "url": "https://api.chatlevel.io/v1"
      }
    ],
    "security": [
      {
        "bearerAuth": []
      }
    ],
    "tags": [
      {
        "name": "devices",
        "description": "Operations related to managing devices."
      },
      {
        "name": "messages",
        "description": "Operations related to sending messages."
      }
    ],
    "paths": {
      "/devices": {
        "get": {
          "tags": ["devices"],
          "summary": "list devices",
          "description": "Retrieve a list of your devices.",
          "operationId": "list-devices",
          "responses": {
            "200": {
              "description": "A JSON array of devices",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "devices": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/device"
                        }
                      },
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "$ref": "#/components/responses/500InternalError"
            }
          }
        },
        "post": {
          "tags": ["devices"],
          "summary": "create device",
          "description": "Create a new device device",
          "operationId": "create-device",
          "requestBody": {
            "required": false,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 20,
                      "description": "User-friendly device name"
                    },
                    "webhookUrl": {
                      "type": "string",
                      "format": "uri",
                      "description": "Webhook URL for receiving events"
                    },
                    "webhookEvents": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": [
                          "connection.open",
                          "connection.closed",
                          "connection.auth",
                          "connection.timeout",
                          "connection.logout",
                          "message.received",
                          "message.sent",
                          "message.updated",
                          "message.deleted",
                          "call"
                        ]
                      },
                      "description": "Events to send to webhook (defaults to all). See webhook documentation for event payloads."
                    },
                    "phoneNumber": {
                      "type": "string",
                      "pattern": "^\\d{8,15}$",
                      "description": "Phone number for pairing code authentication (alternative to QR code). Must be digits only, include country code, no + or spaces.",
                      "example": "31612345678"
                    }
                  }
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Device created successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "device": {
                        "$ref": "#/components/schemas/device"
                      },
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "$ref": "#/components/responses/400InvalidJSON"
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "403": {
              "description": "Device limit reached - subscription does not allow creating more devices",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "integer",
                            "example": 403
                          },
                          "message": {
                            "type": "string",
                            "example": "Device limit reached. You have 2 active device(s) and your subscription allows 2."
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "413": {
              "$ref": "#/components/responses/413PayloadTooLarge"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "$ref": "#/components/responses/500InternalError"
            }
          }
        }
      },
      "/devices/{id}": {
        "get": {
          "tags": ["devices"],
          "summary": "retrieve device",
          "description": "Retrieve a single device by its ID",
          "operationId": "retrieve-device",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Device details",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "device": {
                        "$ref": "#/components/schemas/device"
                      },
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "$ref": "#/components/responses/500InternalError"
            }
          }
        },
        "put": {
          "tags": ["devices"],
          "summary": "update device",
          "description": "Update the device configuration",
          "operationId": "update-device",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/deviceUpdate"
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Device updated successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "device": {
                        "$ref": "#/components/schemas/device"
                      },
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "$ref": "#/components/responses/400InvalidJSON"
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "413": {
              "$ref": "#/components/responses/413PayloadTooLarge"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "$ref": "#/components/responses/500InternalError"
            }
          }
        },
        "delete": {
          "tags": ["devices"],
          "summary": "delete device",
          "description": "Delete a device by ID",
          "operationId": "delete-device",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "responses": {
            "204": {
              "description": "Device deleted successfully"
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "$ref": "#/components/responses/500InternalError"
            }
          }
        }
      },
      "/devices/{id}/disconnect": {
        "post": {
          "tags": ["devices"],
          "summary": "disconnect device",
          "description": "Disconnect a device from WhatsApp",
          "operationId": "disconnect-device",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Device disconnected successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not connected or not found",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "description": "Failed to disconnect device",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "/devices/{id}/restart": {
        "post": {
          "tags": ["devices"],
          "summary": "restart device",
          "description": "Close any open socket (without logout) and start a new session. Optionally provide a phone number to receive a pairing code instead of QR.",
          "operationId": "restart-device",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "requestBody": {
            "required": false,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "phoneNumber": {
                      "type": "string",
                      "pattern": "^\\d{8,15}$",
                      "description": "Phone number for pairing code authentication (alternative to QR code). Must be digits only, include country code.",
                      "example": "31612345678"
                    }
                  }
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Device restarted successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "$ref": "#/components/responses/400InvalidJSON"
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "413": {
              "$ref": "#/components/responses/413PayloadTooLarge"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "description": "Failed to restart device",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "/devices/{id}/messages/text": {
        "post": {
          "tags": ["messages"],
          "summary": "send text message",
          "description": "Send a text message to a chat",
          "operationId": "send-text-message",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["toNumber", "message"],
                  "properties": {
                    "toNumber": {
                      "type": "string",
                      "minLength": 8,
                      "maxLength": 15,
                      "pattern": "^\\d+$",
                      "description": "WhatsApp phone number (digits only)",
                      "example": "31620292537"
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 4096,
                      "description": "Text message to send (WhatsApp message limit: 4096 characters)"
                    }
                  }
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Message sent successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "type": "string",
                        "example": "success"
                      },
                      "messageId": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "$ref": "#/components/responses/400InvalidJSON"
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found or not connected",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "413": {
              "$ref": "#/components/responses/413PayloadTooLarge"
            },
            "422": {
              "$ref": "#/components/responses/422NotAuthenticated"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "description": "Failed to send message",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "/devices/{id}/messages/media": {
        "post": {
          "tags": ["messages"],
          "summary": "send media message",
          "description": "Send a media message (image only: PNG, JPEG, GIF, WebP). Must provide either mediaUrl or mediaBase64, but not both. Maximum file size: 10MB.",
          "operationId": "send-media-message",
          "parameters": [
            {
              "name": "id",
              "in": "path",
              "description": "Device ID",
              "required": true,
              "schema": {
                "type": "integer",
                "minimum": 1,
                "description": "Numeric device identifier"
              }
            }
          ],
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["toNumber"],
                  "properties": {
                    "toNumber": {
                      "type": "string",
                      "minLength": 8,
                      "maxLength": 15,
                      "pattern": "^\\d+$",
                      "description": "WhatsApp phone number (digits only)",
                      "example": "31620292537"
                    },
                    "mediaUrl": {
                      "type": "string",
                      "format": "uri",
                      "description": "URL of the media file (PNG, JPEG, GIF, WebP only, max 10MB)"
                    },
                    "mediaBase64": {
                      "type": "string",
                      "format": "byte",
                      "description": "Base64 encoded media content (PNG, JPEG, GIF, WebP only, max 10MB)"
                    },
                    "mediaCaption": {
                      "type": "string",
                      "maxLength": 1000,
                      "description": "Optional caption for the media"
                    }
                  }
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Media message sent successfully",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "type": "string",
                        "example": "success"
                      },
                      "messageId": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Invalid request - either invalid JSON, missing required fields, or invalid media format",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "integer",
                            "example": 400
                          },
                          "message": {
                            "type": "string",
                            "example": "Invalid image format (only PNG, JPEG, GIF, WebP allowed)"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "401": {
              "$ref": "#/components/responses/401Unauthorized"
            },
            "404": {
              "description": "Device not found or not connected",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            },
            "408": {
              "$ref": "#/components/responses/408Timeout"
            },
            "413": {
              "$ref": "#/components/responses/413PayloadTooLarge"
            },
            "422": {
              "$ref": "#/components/responses/422NotAuthenticated"
            },
            "429": {
              "$ref": "#/components/responses/429RateLimit"
            },
            "500": {
              "description": "Failed to send media message",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "status": {
                        "$ref": "#/components/schemas/status"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "components": {
      "responses": {
        "401Unauthorized": {
          "description": "Missing or invalid authorization header",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "example": "error"
                  },
                  "error": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 401
                      },
                      "message": {
                        "type": "string",
                        "example": "Missing or invalid authorization header. Please provide a Bearer token."
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "408Timeout": {
          "description": "Request timeout",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 408
                      },
                      "message": {
                        "type": "string",
                        "example": "Request timeout"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "400InvalidJSON": {
          "description": "Invalid JSON format",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 400
                      },
                      "message": {
                        "type": "string",
                        "example": "Invalid JSON format"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "413PayloadTooLarge": {
          "description": "Request payload too large",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 413
                      },
                      "message": {
                        "type": "string",
                        "example": "Request payload too large"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "422NotAuthenticated": {
          "description": "Device is not fully authenticated",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 422
                      },
                      "message": {
                        "type": "string",
                        "example": "Device is not fully authenticated. Please scan the QR code to complete the connection."
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "429RateLimit": {
          "description": "Rate limit exceeded",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 429
                      },
                      "message": {
                        "type": "string",
                        "example": "Rate limit exceeded. Maximum 100 requests per minute per user."
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "500InternalError": {
          "description": "Internal server error",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "integer",
                        "example": 500
                      },
                      "message": {
                        "type": "string",
                        "example": "Internal server error"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "schemas": {
        "device": {
          "type": "object",
          "properties": {
            "id": {
              "type": "integer",
              "description": "Unique identifier for the device"
            },
            "name": {
              "type": "string",
              "description": "Name of the device"
            },
            "status": {
              "type": "string",
              "enum": ["connected", "qr", "timeout"],
              "description": "Current connection status: 'qr' when waiting for QR scan, 'connected' when paired, 'timeout' when QR expired"
            },
            "qr": {
              "type": "string",
              "nullable": true,
              "description": "Base64 encoded QR code data URL (available when status is 'qr')"
            },
            "webhookUrl": {
              "type": "string",
              "nullable": true,
              "description": "Webhook URL for receiving events"
            },
            "webhookEvents": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "connection.open",
                  "connection.closed",
                  "connection.auth",
                  "connection.timeout",
                  "connection.logout",
                  "message.received",
                  "message.sent",
                  "message.updated",
                  "message.deleted",
                  "call"
                ]
              },
              "description": "Events to send to webhook. See webhook documentation for event payloads."
            },
            "messagesSent": {
              "type": "integer",
              "description": "Total number of messages sent"
            },
            "subscription_status": {
              "type": "string",
              "enum": ["active", "inactive"],
              "description": "Subscription status of the device. Inactive devices have their WhatsApp sessions stopped."
            },
            "createdAt": {
              "type": "string",
              "format": "date-time",
              "description": "When the device was created"
            }
          }
        },
        "deviceUpdate": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "minLength": 1,
              "maxLength": 20,
              "description": "New name for the device"
            },
            "webhookUrl": {
              "type": "string",
              "nullable": true,
              "description": "Webhook URL for receiving events (null to disable)"
            },
            "webhookEvents": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "connection.open",
                  "connection.closed",
                  "connection.auth",
                  "connection.timeout",
                  "connection.logout",
                  "message.received",
                  "message.sent",
                  "message.updated",
                  "message.deleted",
                  "call"
                ]
              },
              "description": "Events to send to webhook. See webhook documentation for event payloads."
            },
            "subscription_status": {
              "type": "string",
              "enum": ["active", "inactive"],
              "description": "Subscription status. When set to 'inactive', the WhatsApp session is stopped but auth data is preserved for reactivation. When set to 'active', the session is restarted."
            }
          }
        },
        "status": {
          "type": "object",
          "properties": {
            "code": {
              "type": "integer",
              "description": "Status code"
            },
            "message": {
              "type": "string",
              "description": "Status message"
            }
          }
        }
      },
      "securitySchemes": {
        "bearerAuth": {
          "type": "http",
          "scheme": "bearer",
          "description": "API key authentication. Provide your API key as: Authorization: Bearer <api_key>. Alternative: X-API-Key: <api_key> header."
        }
      }
    }
  }